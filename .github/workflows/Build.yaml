name: Build OpenGL Project

on:
  workflow_dispatch:

  push:
    branches:
      - testci
  pull_request:
    branches:
      - testci

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
    - name: Checkout source code
      uses: actions/checkout@v4

    - name: Install MinGW (GCC for Windows)
      shell: powershell
      run: |
        choco install mingw --yes

    - name: Compile with g++
      shell: bash
      run: |
        cd cw
        mkdir -p build
        g++ main.cpp ./src/glad.c -std=c++20 -Iincludes -Llib -lglfw3 -lopengl32 -o build/GuestLiangOpenGLcw.exe


  build-ubuntu:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout source code
      uses: actions/checkout@v4

    - name: Install dependencies
      run: |
        sudo apt update
        sudo apt install -y build-essential cmake libgl1-mesa-dev
        sudo apt install -y libxinerama-dev
        sudo apt install -y libwayland-dev
        sudo apt install -y libxkbcommon-dev
        sudo apt install -y libxcursor-dev
        sudo apt install -y libxi-dev

    - name: Configure and Build
      run: |
        cd cw
        mkdir -p build
        g++ main.cpp ./src/glad.c -std=c++20 -Iincludes -Llib -lglfw3 -lGL -ldl -o build/GuestLiangOpenGLcw
